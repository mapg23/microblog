global:
  scrape_interval: 30s # minst 30


rule_files:
  - /etc/prometheus/alerts/*.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

scrape_configs:
  - job_name: "node"
    static_configs:
      - targets: ["node-exporter:9100"]
  - job_name: "prometheus"
    static_configs:
      - targets: ["0.0.0.0:9090"]
  
  # - job_name: "flask"
  #   scheme: https
  #   metrics_path: /metrics
  #   tls_config:
  #     insecure_skip_verify: true
  #   static_configs:
  #     - targets: ["mapg23.me"]
  #       labels:
  #         instance: flask

  - job_name: "flask"
    scheme: https
    metrics_path: "/metrics"
    tls_config:
      insecure_skip_verify: true
    static_configs:
{% for host in groups['appservers_group'] %}
    - targets:
          - "{{ host }}:8000"
      labels:
        instance: "{{ host }}"
{% endfor %}
